function draw_venn(t,n){function e(){d3.selectAll(".gnode text").transition().duration(100).style("font-size",function(t){return t.computedFontSize})}function r(){var t,n,e,r,a,o;A.each(function(i){var s=this.getBoundingClientRect();1==i.set?((!e||s.left<e)&&(e=s.left),(!r||s.right>r)&&(r=s.right)):2==i.set?((!a||s.left<a)&&(a=s.left),(!o||s.right>o)&&(o=s.right)):0==i.set&&((!t||s.left<t)&&(t=s.left),(!n||s.right>n)&&(n=s.right))}),w.each(function(n){d3.select(this).attr("r",function(n,a){var i=(r-t)/2,s=(o-e)/2;return Math.max(i,s)+10}).attr("transform",function(n,a){if(0==n.set){var i=t+(r-t)/2;return"translate("+i+","+u/2+")"}if(1==n.set){var i=e+(o-e)/2;return"translate("+i+","+u/2+")"}})})}function a(t){A.each(o(.2*t.alpha)).each(i(.5)),A.attr("transform",function(t){return"translate("+[t.x,t.y]+")"}),r()}function o(t){return function(n){n.y+=(n.cy-n.y)*t,n.x+=(n.cx-n.x)*t}}function i(t){var n=d3.geom.quadtree(h);return function(e){var r=e.radius+d+c,a=e.x-r,o=e.x+r,i=e.y-r,s=e.y+r;n.visit(function(n,r,u,l,d){if(n.point&&n.point!==e){var f=e.x-n.point.x,g=e.y-n.point.y,p=Math.sqrt(f*f+g*g),m=e.radius+n.point.radius+(e.color!==n.point.color)*c;m>p&&(p=(p-m)/p*t,e.x-=f*=p,e.y-=g*=p,n.point.x+=f,n.point.y+=g)}return r>o||a>l||u>s||i>d})}}var s=500,u=600,c=6,l=30,d=30,f=3,g=d3.scale.ordinal().domain(d3.range(f)).range(colorbrewer.YlGnBu[3]),p=d3.scale.ordinal().domain(d3.range(f)).rangePoints([0,s],1),m=d3.scale.ordinal().domain(d3.range(f-1)).rangePoints([0,s],1),h=d3.range(n.length).map(function(t){var e=n[t].set,r={radius:getRandomInt(l,d),color:g(e),set:e,cx:p(e),cy:u/2,name:n[t].name};return r}),x=(d3.scale.linear().domain([0,d3.max(h,function(t){return t.radius})]).range([l,d]),d3.layout.force().nodes(h).size([s,u]).gravity(0).charge(0).on("tick",a).on("end",function(){r()}).start()),y=d3.select("#chart").append("svg").attr("width",s).attr("height",u),v=d3.range(f-1).map(function(t){return{radius:Math.sqrt(50)*d,color:g(t),cx:p(t),cy:u/2,set:t}}),z=y.selectAll("g.vennCircle").data(v).enter().append("g"),w=z.append("circle").attr("r",function(t){return s/3}).style("fill",function(t){return t.color}).attr("transform",function(t,n){return"translate("+m(n)+","+u/2+")"}),M=(z.append("text").text(function(t){return 0==t.set?"Extra ingredients you have":"Ingredients you need"}).style("font-size",function(t){return"20px"}).attr("dy",".35em").attr("transform",function(t,n){return"translate("+m(n)+",40)"}),d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){var n=d3.format(".3s");return"<strong>"+t.name+":</strong> <span style='color:red'>"+n(parseFloat(t.set))+"</span>"}));y.call(M);{var A=y.selectAll("g.gnode").data(h).enter().append("g").attr("class",function(t){return"gnode "+t.set}).on("mouseover",function(t){var n=d3.select(this).selectAll("text").style("font-size");n=parseFloat(n),d3.select(this).selectAll("text").transition().duration(100).text(function(t){return t.name.replace(/\(.*?\)/,"")}).style("font-size",function(){return"18px"})}).on("mouseout",function(t){e()}).call(x.drag);A.append("circle").attr("r",function(t){return t.radius}).style("fill",function(t){return t.color}).on("mouseover",M.show).on("mouseout",M.hide),A.append("text").text(function(t){return t.name}).style("font-size",function(t){return t.computedFontSize=Math.min(2*t.radius,(2*t.radius-8)/this.getComputedTextLength()*24),t.computedFontSize+"px"}).attr("dy",".35em")}}function getRandomInt(t,n){return Math.floor(Math.random()*(n-t+1))+t}queue().defer(d3.json,"data.json").await(draw_venn);